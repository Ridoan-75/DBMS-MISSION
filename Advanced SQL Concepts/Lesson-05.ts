=========================================================================================
                                 DATABASE TRIGGER 
=========================================================================================

=========================================================================================
# 0. Trigger ‡¶ï‡ßÄ?
=========================================================================================
Trigger ‡¶π‡¶≤‡ßã ‚Äî
üëâ **‡¶è‡¶ï‡¶ü‡¶æ special database program**
üëâ ‡¶Ø‡ßá‡¶ü‡¶æ **automatic execute ‡¶π‡ßü**
üëâ ‡¶Ø‡¶ñ‡¶® ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü event ‡¶ò‡¶ü‡ßá

Event ‡¶Ø‡ßá‡¶Æ‡¶® ‚Äî
‚úî INSERT  
‚úî UPDATE  
‚úî DELETE  

‡¶è‡¶ï ‡¶ï‡¶•‡¶æ‡ßü ‚Äî
üëâ **Event ‡¶ò‡¶ü‡¶≤‡ßá‡¶á Trigger fire ‡¶ï‡¶∞‡¶¨‡ßá**

=========================================================================================
# 1. Trigger ‡¶ï‡ßá‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßã?
=========================================================================================

‚úî Automatic action  
‚úî Data consistency ‡¶¨‡¶ú‡¶æ‡ßü ‡¶∞‡¶æ‡¶ñ‡¶æ  
‚úî Audit / logging  
‚úî Business rule enforce ‡¶ï‡¶∞‡¶æ  
‚úî Manual ‡¶≠‡ßÅ‡¶≤ ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã  

=========================================================================================
# 2. Example Scenario
=========================================================================================

‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶¶‡ßÅ‡¶ü‡¶ø table ‡¶Ü‡¶õ‡ßá ‚Äî

employees
---------
id  
name  
salary  

salary_log
-----------
log_id  
employee_id  
old_salary  
new_salary  
changed_at  

Goal:
üëâ ‡¶Ø‡¶ñ‡¶®‡¶á employees table-‡¶è salary update ‡¶π‡¶¨‡ßá  
üëâ ‡¶§‡¶ñ‡¶®‡¶á automatically salary_log table-‡¶è record insert ‡¶π‡¶¨‡ßá

=========================================================================================
# 3. Step 1 ‚Äî Log Table ‡¶§‡ßà‡¶∞‡¶ø
=========================================================================================

CREATE TABLE salary_log (
    log_id SERIAL PRIMARY KEY,
    employee_id INT,
    old_salary NUMERIC,
    new_salary NUMERIC,
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

=========================================================================================
# 4. Step 2 ‚Äî Trigger Function ‡¶§‡ßà‡¶∞‡¶ø
=========================================================================================
üëâ PostgreSQL-‡¶è Trigger ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø SQL ‡¶¶‡¶ø‡ßü‡ßá ‡¶π‡ßü ‡¶®‡¶æ  
üëâ ‡¶Ü‡¶ó‡ßá **Trigger Function** ‡¶¨‡¶æ‡¶®‡¶æ‡¶§‡ßá ‡¶π‡ßü

-----------------------------------------------------------------------------------------
# Trigger Function
-----------------------------------------------------------------------------------------

CREATE OR REPLACE FUNCTION log_salary_change()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
BEGIN
    INSERT INTO salary_log(employee_id, old_salary, new_salary)
    VALUES (OLD.id, OLD.salary, NEW.salary);

    RETURN NEW;
END;
$$;

‚úî OLD ‚Üí ‡¶Ü‡¶ó‡ßá‡¶∞ data  
‚úî NEW ‚Üí ‡¶®‡¶§‡ßÅ‡¶® data  
‚úî RETURN NEW ‚Üí UPDATE continue ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø  

=========================================================================================
# 5. Step 3 ‚Äî Trigger ‡¶§‡ßà‡¶∞‡¶ø
=========================================================================================

CREATE TRIGGER after_salary_update
AFTER UPDATE OF salary ON employees
FOR EACH ROW
EXECUTE FUNCTION log_salary_change();

‚úî AFTER UPDATE ‚Üí update ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá fire ‡¶ï‡¶∞‡¶¨‡ßá  
‚úî OF salary ‚Üí ‡¶∂‡ßÅ‡¶ß‡ßÅ salary change ‡¶π‡¶≤‡ßá  
‚úî FOR EACH ROW ‚Üí ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶æ row-‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø  

=========================================================================================
# 6. Trigger Test ‡¶ï‡¶∞‡¶æ
=========================================================================================

UPDATE employees
SET salary = 70000
WHERE id = 2;

‚úî Update ‡¶π‡¶¨‡ßá  
‚úî Trigger fire ‡¶ï‡¶∞‡¶¨‡ßá  
‚úî salary_log-‡¶è record insert ‡¶π‡¶¨‡ßá  

=========================================================================================
# 7. Trigger Execution Flow
=========================================================================================

1Ô∏è‚É£ UPDATE query run ‡¶π‡ßü  
2Ô∏è‚É£ salary column change detect ‡¶π‡ßü  
3Ô∏è‚É£ Trigger fire ‡¶ï‡¶∞‡ßá  
4Ô∏è‚É£ Trigger function execute ‡¶π‡ßü  
5Ô∏è‚É£ OLD & NEW value log table-‡¶è insert ‡¶π‡ßü  

=========================================================================================
# 8. BEFORE vs AFTER Trigger
=========================================================================================

BEFORE Trigger:
---------------
‚úî Data change ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá  
‚úî Validation / modify data  

AFTER Trigger:
--------------
‚úî Data change ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞‡ßá  
‚úî Logging / audit  

=========================================================================================
# 9. Common Mistakes
=========================================================================================

‚ùå Trigger function ‡¶õ‡¶æ‡ßú‡¶æ trigger ‡¶¨‡¶æ‡¶®‡¶æ‡¶®‡ßã  
‚ùå RETURN NEW / OLD ‡¶®‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ  
‚ùå Unnecessary trigger use (performance issue)  
‚ùå Recursive trigger ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ  

=========================================================================================
# 10. Summary
=========================================================================================

‚úî Trigger = automatic execution  
‚úî Event-based logic  
‚úî OLD & NEW keyword ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£  
‚úî Audit/logging-‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø best  
‚úî Data consistency ‡¶¨‡¶ú‡¶æ‡ßü ‡¶∞‡¶æ‡¶ñ‡ßá  

=========================================================================================
                                THE END
=========================================================================================
