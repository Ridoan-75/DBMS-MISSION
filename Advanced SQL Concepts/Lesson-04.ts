=========================================================================================
                                 STORED PROCEDURE 
=========================================================================================

=========================================================================================
# 0. Example 2 ‡¶è‡¶∞ Goal
=========================================================================================
üëâ ‡¶è‡¶Æ‡¶® ‡¶è‡¶ï‡¶ü‡¶æ Stored Procedure ‡¶¨‡¶æ‡¶®‡¶æ‡¶¨‡ßã  
üëâ ‡¶Ø‡ßá‡¶ü‡¶æ **employee-‡¶è‡¶∞ ID ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶®‡ßá‡¶¨‡ßá**  
üëâ ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßá‡¶á employee-‡¶è‡¶∞ **salary update ‡¶ï‡¶∞‡¶¨‡ßá**

=========================================================================================
# 1. Scenario
=========================================================================================

Table: employees
----------------
id  
name  
department  
salary  

Use Case:
---------
üëâ HR department employee salary update ‡¶ï‡¶∞‡¶¨‡ßá

=========================================================================================
# 2. Why This Example Is Important
=========================================================================================

‚úî Real-world CRUD operation  
‚úî UPDATE query practice  
‚úî Parameter handling ‡¶∂‡ßá‡¶ñ‡¶æ  
‚úî Business logic DB-level ‡¶è ‡¶∞‡¶æ‡¶ñ‡¶æ  

=========================================================================================
# 3. Stored Procedure Structure (Reminder)
=========================================================================================

CREATE OR REPLACE PROCEDURE procedure_name(
    parameter datatype
)
LANGUAGE plpgsql
AS $$
BEGIN
    SQL statements;
END;
$$;

=========================================================================================
# 4. Procedure Example 2 ‚Äî Update Employee Salary
=========================================================================================

-----------------------------------------------------------------------------------------
# 4.1 Procedure ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ
-----------------------------------------------------------------------------------------

CREATE OR REPLACE PROCEDURE update_employee_salary(
    emp_id INT,
    new_salary NUMERIC
)
LANGUAGE plpgsql
AS $$
BEGIN
    UPDATE employees
    SET salary = new_salary
    WHERE id = emp_id;
END;
$$;

‚úî emp_id ‚Üí ‡¶ï‡ßã‡¶® employee update ‡¶π‡¶¨‡ßá  
‚úî new_salary ‚Üí ‡¶®‡¶§‡ßÅ‡¶® salary  
‚úî WHERE clause ‚Üí specific row update  

=========================================================================================
# 5. Procedure Call ‡¶ï‡¶∞‡¶æ
=========================================================================================

CALL update_employee_salary(3, 65000);

‚úî Employee ID = 3  
‚úî Salary ‡¶π‡¶¨‡ßá = 65000  

=========================================================================================
# 6. Optional Improvement ‚Äî Affected Row Check
=========================================================================================
üëâ ‡¶Ø‡¶¶‡¶ø employee ID ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶æ‡¶π‡¶≤‡ßá message ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã

-----------------------------------------------------------------------------------------
# Improved Version
-----------------------------------------------------------------------------------------

CREATE OR REPLACE PROCEDURE update_employee_salary_safe(
    emp_id INT,
    new_salary NUMERIC
)
LANGUAGE plpgsql
AS $$
BEGIN
    UPDATE employees
    SET salary = new_salary
    WHERE id = emp_id;

    IF NOT FOUND THEN
        RAISE NOTICE 'Employee with ID % not found', emp_id;
    END IF;
END;
$$;

‚úî FOUND ‚Üí check ‡¶ï‡¶∞‡ßá row update ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ  
‚úî RAISE NOTICE ‚Üí message ‡¶¶‡ßá‡¶ñ‡¶æ‡ßü  

=========================================================================================
# 7. Execution Flow
=========================================================================================

1Ô∏è‚É£ CALL statement execute ‡¶π‡ßü  
2Ô∏è‚É£ emp_id ‡¶ì new_salary receive ‡¶ï‡¶∞‡ßá  
3Ô∏è‚É£ UPDATE query ‡¶ö‡¶≤‡ßá  
4Ô∏è‚É£ Row ‡¶•‡¶æ‡¶ï‡¶≤‡ßá update ‡¶π‡ßü  
5Ô∏è‚É£ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá notice ‡¶¶‡ßá‡¶ñ‡¶æ‡ßü  

=========================================================================================
# 8. Common Mistakes
=========================================================================================

‚ùå WHERE clause ‡¶®‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ (‡¶∏‡¶¨ row update ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá)  
‚ùå Parameter order ‡¶≠‡ßÅ‡¶≤ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ  
‚ùå CALL ‡¶õ‡¶æ‡ßú‡¶æ run ‡¶ï‡¶∞‡¶æ  
‚ùå Safe check ‡¶®‡¶æ ‡¶∞‡¶æ‡¶ñ‡¶æ  

=========================================================================================
# 9. Real-World Usage
=========================================================================================

‚úî Payroll system  
‚úî HR management system  
‚úî Admin panel salary update  
‚úî Business rule enforcement  

=========================================================================================
# 10. Summary
=========================================================================================

‚úî Procedure input ‡¶®‡ßá‡ßü  
‚úî UPDATE operation ‡¶ï‡¶∞‡ßá  
‚úî Safe version ‡¶¨‡ßá‡¶∂‡¶ø recommended  
‚úî Database-level logic secure & efficient  

=========================================================================================
                                THE END
=========================================================================================
