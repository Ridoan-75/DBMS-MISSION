=========================================================================================
                         ALTER TABLE & CONSTRAINTS 
=========================================================================================

=========================================================================================
# 0. ALTER TABLE ‡¶ï‡ßÄ?
=========================================================================================
ALTER TABLE ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü ‚Äî
üëâ ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® (existing) ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ structure ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø

‡¶Ø‡ßá‡¶Æ‡¶® ‚Äî
- ‡¶®‡¶§‡ßÅ‡¶® column ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
- column delete ‡¶ï‡¶∞‡¶æ
- column ‡¶è‡¶∞ data type ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ
- constraint ‡¶Ø‡ßã‡¶ó / ‡¶¨‡¶æ‡¶¶ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
- table rename ‡¶ï‡¶∞‡¶æ
- column rename ‡¶ï‡¶∞‡¶æ

=========================================================================================
# 1. COLUMN ADD ‡¶ï‡¶∞‡¶æ (ADD COLUMN)
=========================================================================================

-- ‡¶è‡¶ï‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® column ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
ALTER TABLE users
ADD COLUMN age INTEGER;

-- ‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï column ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
ALTER TABLE users
ADD COLUMN phone VARCHAR(15),
ADD COLUMN address TEXT;

=========================================================================================
# 2. COLUMN DROP ‡¶ï‡¶∞‡¶æ (DROP COLUMN)
=========================================================================================

-- ‡¶è‡¶ï‡¶ü‡¶ø column delete ‡¶ï‡¶∞‡¶æ
ALTER TABLE users
DROP COLUMN age;

-- ‚ö†Ô∏è ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ:
-- column drop ‡¶ï‡¶∞‡¶≤‡ßá data permanently delete ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá

=========================================================================================
# 3. COLUMN DATA TYPE ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ
=========================================================================================

ALTER TABLE users
ALTER COLUMN phone TYPE VARCHAR(20);

-- ‡¶Ø‡¶¶‡¶ø casting ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶π‡ßü
ALTER TABLE users
ALTER COLUMN age TYPE VARCHAR(5)
USING age::VARCHAR;

=========================================================================================
# 4. COLUMN NAME ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ
=========================================================================================

ALTER TABLE users
RENAME COLUMN phone TO mobile_number;

=========================================================================================
# 5. TABLE NAME ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ
=========================================================================================

ALTER TABLE users
RENAME TO customers;

=========================================================================================
=========================================================================================
                        CONSTRAINTS (DETAILS)
=========================================================================================
=========================================================================================

=========================================================================================
# 6. CONSTRAINT ‡¶ï‡ßÄ?
=========================================================================================
Constraint ‡¶Æ‡¶æ‡¶®‡ßá ‚Äî
üëâ Database-level rule ‡¶Ø‡¶æ data integrity ‡¶¨‡¶ú‡¶æ‡ßü ‡¶∞‡¶æ‡¶ñ‡ßá

‡¶Ö‡¶∞‡ßç‡¶•‡¶æ‡ßé ‚Äî
- ‡¶≠‡ßÅ‡¶≤ data insert ‡¶π‡¶§‡ßá ‡¶¶‡ßá‡ßü ‡¶®‡¶æ
- table ‡¶ï‡ßá safe ‡¶ï‡¶∞‡ßá

=========================================================================================
# 7. PRIMARY KEY Constraint
=========================================================================================

-- Primary Key ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
ALTER TABLE users
ADD CONSTRAINT users_pk PRIMARY KEY (id);

-- Primary Key drop ‡¶ï‡¶∞‡¶æ
ALTER TABLE users
DROP CONSTRAINT users_pk;

=========================================================================================
# 8. UNIQUE Constraint
=========================================================================================

-- UNIQUE constraint ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
ALTER TABLE users
ADD CONSTRAINT users_email_unique UNIQUE (email);

-- UNIQUE constraint drop ‡¶ï‡¶∞‡¶æ
ALTER TABLE users
DROP CONSTRAINT users_email_unique;

=========================================================================================
# 9. NOT NULL Constraint
=========================================================================================

-- NOT NULL ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
ALTER TABLE users
ALTER COLUMN name SET NOT NULL;

-- NOT NULL ‡¶¨‡¶æ‡¶¶ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
ALTER TABLE users
ALTER COLUMN name DROP NOT NULL;

=========================================================================================
# 10. CHECK Constraint
=========================================================================================

-- CHECK constraint ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
ALTER TABLE users
ADD CONSTRAINT users_age_check CHECK (age >= 18);

-- CHECK constraint drop ‡¶ï‡¶∞‡¶æ
ALTER TABLE users
DROP CONSTRAINT users_age_check;

=========================================================================================
# 11. FOREIGN KEY Constraint
=========================================================================================

-- FOREIGN KEY ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
ALTER TABLE orders
ADD CONSTRAINT orders_user_fk
FOREIGN KEY (user_id)
REFERENCES users(id);

-- FOREIGN KEY drop ‡¶ï‡¶∞‡¶æ
ALTER TABLE orders
DROP CONSTRAINT orders_user_fk;

=========================================================================================
# 12. DEFAULT Constraint
=========================================================================================

-- DEFAULT value ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ
ALTER TABLE users
ALTER COLUMN is_active SET DEFAULT true;

-- DEFAULT value ‡¶¨‡¶æ‡¶¶ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
ALTER TABLE users
ALTER COLUMN is_active DROP DEFAULT;

=========================================================================================
# 13. MULTIPLE CONSTRAINT ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ADD ‡¶ï‡¶∞‡¶æ
=========================================================================================

ALTER TABLE users
ADD CONSTRAINT users_email_unique UNIQUE (email),
ADD CONSTRAINT users_age_check CHECK (age >= 18);

=========================================================================================
# 14. CONSTRAINT NAME ‡¶ï‡ßá‡¶® ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£?
=========================================================================================
Constraint ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶≤‡ßá ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ ‚Äî
- ‡¶∏‡¶π‡¶ú‡ßá DROP ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡ßü
- Error message readable ‡¶π‡ßü
- Production DB manage ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶π‡¶ú ‡¶π‡ßü

‚ùå ‡¶ñ‡¶æ‡¶∞‡¶æ‡¶™:
ADD UNIQUE (email);

‚úÖ ‡¶≠‡¶æ‡¶≤‡ßã:
ADD CONSTRAINT users_email_unique UNIQUE (email);

=========================================================================================
# 15. REAL-WORLD PRACTICE EXAMPLE
=========================================================================================

ALTER TABLE users
ADD COLUMN created_at DATE DEFAULT CURRENT_DATE,
ADD CONSTRAINT users_email_unique UNIQUE (email),
ALTER COLUMN name SET NOT NULL;

=========================================================================================
# 16. COMMON MISTAKES
=========================================================================================
‚ùå Data ‡¶•‡¶æ‡¶ï‡¶æ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡ßü PRIMARY KEY add ‡¶ï‡¶∞‡¶æ (duplicate ‡¶•‡¶æ‡¶ï‡¶≤‡ßá fail ‡¶ï‡¶∞‡¶¨‡ßá)
‚ùå Column drop ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá impact ‡¶®‡¶æ ‡¶≠‡¶æ‡¶¨‡¶æ
‚ùå Constraint name ‡¶®‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
‚ùå Foreign key add ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá referenced table check ‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ

=========================================================================================
# 17. SUMMARY (ONE LOOK)
=========================================================================================
ALTER TABLE ‚Üí structure change  
ADD COLUMN ‚Üí ‡¶®‡¶§‡ßÅ‡¶® column  
DROP COLUMN ‚Üí column delete  
ALTER COLUMN ‚Üí type / default / not null change  
ADD CONSTRAINT ‚Üí rule ‡¶Ø‡ßã‡¶ó  
DROP CONSTRAINT ‚Üí rule delete  

=========================================================================================
                               THE END
=========================================================================================
